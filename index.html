<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fga. Amanda Elizabeth Gomes</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Ícones Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brandTerra: '#E07A5F',
                        brandMoss: '#606C38',
                        brandMustard: '#E09F3E',
                        brandBeige: '#F4F1DE',
                        brandCream: '#FEFAE0'
                    },
                    fontFamily: {
                        serif: ['"Cormorant Garamond"', 'serif'],
                        sans: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F4F1DE; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #e5e7eb; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #d1d5db; }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Gestão de Visibilidade */
        .tab-content { display: none !important; height: 100%; width: 100%; flex-direction: column; overflow-y: auto; }
        .tab-content.active { display: flex !important; }
        
        .nav-btn.active { 
            background-color: #E07A5F; 
            color: white; 
            font-weight: bold; 
            transform: translateX(4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .chat-bubble-user { background-color: #E07A5F; color: white; border-bottom-right-radius: 0; }
        .chat-bubble-bot { background-color: white; color: #374151; border-bottom-left-radius: 0; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Estilo para garantir que a foto não corte no topo */
        .profile-img-container {
            position: relative;
            overflow: hidden;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .profile-img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top center;
        }
    </style>
</head>
<body class="font-sans text-gray-700 h-screen overflow-hidden flex flex-col md:flex-row p-0 md:p-6">

    <!-- Mobile Menu Button -->
    <button onclick="toggleMobileMenu()" class="md:hidden fixed top-4 right-4 z-[60] bg-brandMoss text-white p-2 rounded-full shadow-lg">
        <i id="menu-icon" data-lucide="menu"></i>
    </button>

    <div class="flex-1 w-full max-w-7xl mx-auto bg-white md:rounded-3xl shadow-2xl flex flex-col md:flex-row overflow-hidden border border-brandMoss/10 relative h-full">

        <!-- SIDEBAR -->
        <aside id="sidebar" class="absolute md:relative z-50 w-full md:w-80 bg-brandMoss text-white h-full flex flex-col transition-transform duration-300 -translate-x-full md:translate-x-0 shrink-0 shadow-xl">
            
            <div class="p-8 text-center md:text-left bg-[#4d572d]">
                <div class="w-20 h-20 bg-white/10 rounded-full mx-auto md:mx-0 flex items-center justify-center mb-4 border-2 border-brandMustard overflow-hidden relative shadow-lg">
                    <svg viewBox="0 0 100 100" class="w-full h-full" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="50" fill="#606C38" />
                        <circle cx="50" cy="50" r="46" stroke="#E09F3E" stroke-width="2" opacity="0.5" />
                        <path d="M70 35C70 26.7157 61.0457 20 50 20C38.9543 20 30 26.7157 30 35C30 43.2843 38.9543 50 50 50C52.3 50 54.5 49.7 56.5 49.2L65 54L62.5 45.5C67.1 43 70 39.3 70 35Z" fill="#E07A5F" opacity="0.9"/>
                        <text x="50" y="68" font-family="serif" font-size="38" fill="#FEFAE0" text-anchor="middle" font-weight="bold" letter-spacing="2">AE</text>
                        <text x="50" y="82" font-family="sans-serif" font-size="8" fill="#FEFAE0" text-anchor="middle" opacity="0.8" letter-spacing="1">FONO</text>
                    </svg>
                </div>
                <h1 class="font-serif text-xl font-bold tracking-wide leading-tight">Fono<br>Amanda Elizabeth Gomes</h1>
                <p class="text-[10px] text-white/60 mt-1 uppercase tracking-widest">CRFa 2-19715</p>
            </div>

            <nav class="flex-1 p-4 overflow-y-auto custom-scrollbar">
                <ul class="space-y-2">
                    <li><button onclick="switchTab('home')" id="btn-home" class="nav-btn active w-full flex items-center gap-3 p-3 rounded-xl transition-all text-sm font-medium hover:bg-white/10"><i data-lucide="home" size="18"></i> Início</button></li>
                    <li><button onclick="switchTab('about')" id="btn-about" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all text-sm font-medium hover:bg-white/10"><i data-lucide="user" size="18"></i> Sobre a Fono</button></li>
                    <li><button onclick="switchTab('chat')" id="btn-chat" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all text-sm font-medium hover:bg-white/10"><i data-lucide="bot" size="18"></i> Assistente Virtual</button></li>
                    <li><button onclick="switchTab('courses')" id="btn-courses" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all text-sm font-medium hover:bg-white/10"><i data-lucide="graduation-cap" size="18"></i> Cursos</button></li>
                    <li><button onclick="switchTab('free')" id="btn-free" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all text-sm font-medium hover:bg-white/10"><i data-lucide="download" size="18"></i> Downloads Grátis</button></li>
                    <li><button onclick="switchTab('store')" id="btn-store" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all text-sm font-medium hover:bg-white/10"><i data-lucide="shopping-bag" size="18"></i> Loja</button></li>
                </ul>
            </nav>

            <div class="p-6 border-t border-white/10 bg-brandMoss shrink-0 text-center">
                <div class="flex gap-4 justify-center">
                    <a href="https://instagram.com/amandaelizabethfono" target="_blank" class="text-white hover:text-brandTerra transition-colors"><i data-lucide="instagram" size="20"></i></a>
                    <a href="mailto:amanda.elizabethgs@gmail.com" class="text-white hover:text-brandTerra transition-colors"><i data-lucide="mail" size="20"></i></a>
                    <a href="https://wa.me/5511960808313" target="_blank" class="text-white hover:text-brandTerra transition-colors"><i data-lucide="message-circle" size="20"></i></a>
                </div>
            </div>
        </aside>

        <!-- CONTENT AREA -->
        <main class="flex-1 bg-[#FAFAF5] relative overflow-hidden flex flex-col h-full w-full">
            
            <!-- 1. HOME -->
            <section id="tab-home" class="tab-content active p-6 md:p-12 fade-in items-center justify-center">
                <div class="w-64 h-80 md:w-80 md:h-[450px] rounded-3xl mb-6 shadow-2xl border-4 border-brandMustard shrink-0 profile-img-container shadow-xl">
                    <img src="https://lh3.googleusercontent.com/d/1RGurpPnEQguarRCax2MeI9HdBPNFBl8K" alt="Fga. Amanda Elizabeth Gomes">
                </div>
                <span class="bg-brandMustard/20 text-brandMustard px-4 py-1 rounded-full text-xs font-bold uppercase tracking-widest mb-4">Bem-vindos</span>
                <h1 class="font-serif text-3xl md:text-5xl font-bold text-brandMoss mb-2 leading-tight text-center">Fono Amanda Elizabeth Gomes</h1>
                <p class="text-brandTerra text-base md:text-lg font-medium tracking-wide uppercase mb-6 text-center italic">Fonoaudiologia Humanizada & Conexão Familiar</p>
                <p class="max-w-2xl text-gray-600 mb-10 leading-relaxed text-sm md:text-base text-center px-4">
                    Acolhendo famílias e transformando vidas através da comunicação. Especialista em desenvolvimento infantil, linguagem, TEA e motricidade orofacial.
                </p>
                <div class="flex flex-col md:flex-row gap-4 w-full max-w-lg mb-8 px-4">
                    <button onclick="switchTab('chat')" class="flex-1 bg-brandTerra hover:bg-[#C45F44] text-white py-4 px-6 rounded-xl font-bold shadow-lg transition-all hover:-translate-y-1 flex items-center justify-center gap-2">
                        <i data-lucide="bot" size="20"></i> Assistente Virtual
                    </button>
                    <button onclick="switchTab('store')" class="flex-1 bg-brandMoss hover:bg-[#4d572d] text-white py-4 px-6 rounded-xl font-bold shadow-lg transition-all hover:-translate-y-1 flex items-center justify-center gap-2">
                        <i data-lucide="shopping-bag" size="20"></i> Ver E-books
                    </button>
                </div>
            </section>

            <!-- 2. SOBRE A FONO -->
            <section id="tab-about" class="tab-content p-6 md:p-12 fade-in overflow-y-auto custom-scrollbar">
                <div class="max-w-4xl mx-auto w-full">
                    <h2 class="font-serif text-3xl md:text-4xl font-bold text-brandMoss mb-8 flex items-center gap-3 border-b border-brandMoss/10 pb-4">
                        <i data-lucide="user" class="text-brandMustard" size="32"></i> Quem sou eu
                    </h2>
                    <div class="flex flex-col md:flex-row gap-10 mb-12 items-start">
                        <div class="w-full md:w-2/5 shrink-0">
                            <div class="w-full aspect-[3/4] rounded-3xl border-2 border-brandMustard relative profile-img-container shadow-xl group">
                                <img src="https://lh3.googleusercontent.com/d/1RGurpPnEQguarRCax2MeI9HdBPNFBl8K" alt="Fono Amanda" class="transition-transform duration-700 group-hover:scale-105">
                                <div class="absolute bottom-0 w-full bg-brandMoss/90 backdrop-blur-sm text-white text-center py-2 text-sm font-bold tracking-widest uppercase">CRFa 2-19715</div>
                            </div>
                        </div>
                        <div class="flex-1 space-y-4 text-gray-700 text-sm md:text-base leading-relaxed text-justify">
                            <p>Olá! Sou a <strong>Fono Amanda Elizabeth Gomes</strong>. Minha missão é proporcionar um ambiente seguro e estimulante para o desenvolvimento da comunicação infantil.</p>
                            <p>Com vasta experiência em <strong>atrasos de fala, TEA e motricidade orofacial</strong>, acredito que o envolvimento da família é a chave para o sucesso terapêutico.</p>
                            <p>Minha atuação baseia-se nos pilares da <span class="text-brandTerra font-bold">singularidade, individualidade, potencialidade, autonomia e resultados.</span></p>
                            <p>O foco é oferecer intervenções personalizadas que consideram o paciente de forma integral, promovendo evolução consistente e aplicável à rotina.</p>
                            <p class="font-medium text-brandMoss text-lg">Acredito numa fonoaudiologia humanizada e estratégica.</p>
                            <div class="flex flex-wrap gap-2 pt-4">
                                <span class="bg-brandCream text-brandMoss px-3 py-1 rounded-lg text-xs font-bold border border-brandMoss/10 shadow-sm">TEA</span>
                                <span class="bg-brandCream text-brandMoss px-3 py-1 rounded-lg text-xs font-bold border border-brandMoss/10 shadow-sm">Linguagem</span>
                                <span class="bg-brandCream text-brandMoss px-3 py-1 rounded-lg text-xs font-bold border border-brandMoss/10 shadow-sm">Motricidade Oral</span>
                            </div>
                        </div>
                    </div>
                    <!-- DIFERENCIAIS LIMPOS -->
                    <h3 class="font-serif text-2xl font-bold text-brandTerra mb-10 text-center border-t border-brandMoss/10 pt-8 uppercase tracking-widest">Diferenciais</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-12 pb-12">
                        <div class="flex flex-col items-center text-center group">
                            <div class="mb-4 text-brandTerra transition-transform duration-300 group-hover:scale-110"><i data-lucide="sparkles" size="44"></i></div>
                            <h4 class="font-bold text-brandMoss mb-3 text-lg uppercase tracking-tight">5 Pilares</h4>
                            <p class="text-sm text-gray-500 leading-relaxed max-w-[250px]">Foco na singularidade e potencialidade de cada criança.</p>
                        </div>
                        <div class="flex flex-col items-center text-center group">
                            <div class="mb-4 text-brandMustard transition-transform duration-300 group-hover:scale-110"><i data-lucide="heart" size="44"></i></div>
                            <h4 class="font-bold text-brandMoss mb-3 text-lg uppercase tracking-tight">Visão Integral</h4>
                            <p class="text-sm text-gray-500 leading-relaxed max-w-[250px]">Intervenções que vão além do óbvio clínico.</p>
                        </div>
                        <div class="flex flex-col items-center text-center group">
                            <div class="mb-4 text-brandMoss transition-transform duration-300 group-hover:scale-110"><i data-lucide="book-open" size="44"></i></div>
                            <h4 class="font-bold text-brandMoss mb-3 text-lg uppercase tracking-tight">Resultados</h4>
                            <p class="text-sm text-gray-500 leading-relaxed max-w-[250px]">Fonoaudiologia estratégica e aplicável à rotina.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. CHAT -->
            <section id="tab-chat" class="tab-content relative flex-col h-full bg-[#FAFAF5] overflow-hidden">
                <div id="chat-messages" class="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar space-y-4">
                    <!-- Mensagens via JS -->
                </div>
                <div id="typing-indicator" class="hidden px-8 py-2 text-xs text-brandMoss italic animate-pulse font-bold flex items-center gap-2">
                    <i data-lucide="bot" size="14"></i> Amanda está a formular uma orientação...
                </div>
                <div class="bg-white p-4 border-t border-brandMoss/10 shrink-0 shadow-lg z-20">
                    <div class="flex gap-3 relative items-center max-w-3xl mx-auto">
                        <input type="text" id="chat-input" onkeydown="handleChatEnter(event)" placeholder="Escreva sua dúvida aqui..." class="w-full bg-brandBeige/50 text-gray-700 rounded-xl pl-5 pr-14 py-4 focus:outline-none focus:ring-2 focus:ring-brandTerra/50 transition-all text-sm" />
                        <button id="send-btn" onclick="handleSendMessage()" class="absolute right-2 w-10 h-10 bg-brandTerra rounded-lg flex items-center justify-center text-white hover:bg-[#C45F44] transition-all shadow-md">
                            <i data-lucide="send" size="18"></i>
                        </button>
                    </div>
                    <p class="text-center text-[10px] text-gray-400 mt-2 font-bold tracking-tight uppercase">Este assistente não realiza diagnósticos e não substitui consulta.</p>
                </div>
            </section>

            <!-- 4. CURSOS -->
            <section id="tab-courses" class="tab-content p-6 md:p-12 fade-in items-center justify-center text-center">
                <div class="w-24 h-24 bg-brandCream rounded-full flex items-center justify-center mb-6 border-2 border-brandMustard border-dashed"><i data-lucide="graduation-cap" size="40" class="text-brandMustard"></i></div>
                <h2 class="font-serif text-3xl font-bold text-brandMoss mb-3 uppercase tracking-widest">Cursos</h2>
                <div class="flex items-center gap-2 text-brandTerra bg-brandTerra/10 px-4 py-2 rounded-full font-bold text-sm mb-6 mx-auto w-fit"><i data-lucide="hammer" size="16"></i><span>Página em Construção</span></div>
                <p class="text-gray-500 max-w-md mx-auto">Novos conteúdos para ajudar famílias estão a caminho.</p>
            </section>

            <!-- 5. DOWNLOADS -->
            <section id="tab-free" class="tab-content p-6 md:p-12 fade-in overflow-y-auto items-center justify-center text-center">
                <div class="w-24 h-24 bg-brandCream rounded-full flex items-center justify-center mb-6 border-2 border-brandMustard border-dashed"><i data-lucide="download" size="40" class="text-brandMustard"></i></div>
                <h2 class="font-serif text-3xl font-bold text-brandMoss mb-3 uppercase tracking-widest">Downloads</h2>
                <div class="flex items-center gap-2 text-brandTerra bg-brandTerra/10 px-4 py-2 rounded-full font-bold text-sm mb-6 mx-auto w-fit"><i data-lucide="hammer" size="16"></i><span>Página em Construção</span></div>
                <p class="text-gray-500 max-w-md mx-auto">Guias práticos para baixar em breve.</p>
            </section>

            <!-- 6. LOJA -->
            <section id="tab-store" class="tab-content p-6 md:p-12 fade-in overflow-y-auto custom-scrollbar">
                <div class="max-w-6xl mx-auto w-full">
                    <div class="flex flex-col md:flex-row justify-between items-end mb-8 border-b border-brandMoss/10 pb-6">
                        <div>
                            <h2 class="font-serif text-3xl font-bold text-brandMoss mb-2 flex items-center gap-3"><i data-lucide="shopping-bag" class="text-brandMustard" size="32"></i> Loja de Materiais</h2>
                            <p class="text-gray-500 text-sm font-sans uppercase tracking-widest font-bold">E-books Exclusivos</p>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8 pb-12">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-brandMoss/10 flex flex-col hover:border-brandMustard transition-all group">
                            <div class="aspect-video bg-brandBeige rounded-xl mb-5 overflow-hidden shadow-inner">
                                <img src="https://lh3.googleusercontent.com/d/1-CZEYdhWXs48GU4EiQnzIh6ON9SeBX_I" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                            </div>
                            <h3 class="font-bold text-brandMoss text-xl mb-2 font-serif uppercase tracking-tight">Férias com Conexão</h3>
                            <p class="text-sm text-gray-500 mb-6 flex-1 text-justify leading-relaxed">Estimule a fala e o vínculo durante as férias escolares.</p>
                            <a href="https://pay.kiwify.com.br/8AJ1RUP" target="_blank" class="w-full bg-brandMoss text-white p-4 rounded-xl text-center font-bold uppercase text-xs tracking-widest hover:bg-[#4d572d] transition-all">Quero Comprar</a>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-brandMoss/10 flex flex-col hover:border-brandTerra transition-all group">
                            <div class="aspect-video bg-brandCream rounded-xl mb-5 overflow-hidden shadow-inner">
                                <img src="https://lh3.googleusercontent.com/d/1BhEaiRPJ3pt5uheG05raKbmHHO5BVoY_" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                            </div>
                            <h3 class="font-bold text-brandMoss text-xl mb-2 font-serif uppercase tracking-tight">Férias sem Caos</h3>
                            <p class="text-sm text-gray-500 mb-6 flex-1 text-justify leading-relaxed">Estratégias práticas para organização e calma na rotina de férias.</p>
                            <a href="https://pay.kiwify.com.br/5FJGU6K" target="_blank" class="w-full bg-brandMustard text-white p-4 rounded-xl text-center font-bold uppercase text-xs tracking-widest hover:bg-[#c2862a] transition-all">Saiba Mais</a>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- LOGICA E INTEGRAÇÃO GEMINI -->
    <script>
        // CHAVE DA API INSERIDA CONFORME SOLICITADO
        const apiKey = "AIzaSyBn6LHFSTczoFsb6Er0Q7MSSfQc-4fFl2g"; 
        
        lucide.createIcons();
        
        let chatInitialized = false;
        let chatHistory = []; 

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            const selectedTab = document.getElementById('tab-' + tabId);
            const selectedBtn = document.getElementById('btn-' + tabId);
            
            if (selectedTab) selectedTab.classList.add('active');
            if (selectedBtn) selectedBtn.classList.add('active');

            if (window.innerWidth < 768) { toggleMobileMenu(true); }

            if (tabId === 'chat' && !chatInitialized) {
                setTimeout(() => {
                    const welcomeText = "Olá! Sou o assistente virtual de apoio da **Fga. Amanda Elizabeth Gomes**. Estou aqui para orientar pais e cuidadores de forma simples, acolhedora e responsável sobre o desenvolvimento infantil.\n\nComo posso ajudar hoje?";
                    addMessage(welcomeText, 'bot');
                    chatInitialized = true;
                }, 400);
            }
        }

        function toggleMobileMenu(forceClose = false) {
            const sidebar = document.getElementById('sidebar');
            if (forceClose || !sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.add('-translate-x-full');
            } else {
                sidebar.classList.remove('-translate-x-full');
            }
        }

        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const typingIndicator = document.getElementById('typing-indicator');

        function addMessage(text, sender, showContact = false) {
            if (!chatMessages) return;
            const isBot = sender === 'bot';
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex w-full mb-6 ${isBot ? 'justify-start' : 'justify-end'} fade-in`;
            
            let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            let contentHtml = `
                <div class="flex max-w-[90%] md:max-w-[75%] ${isBot ? 'flex-row' : 'flex-row-reverse'} gap-3 items-end">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm ${isBot ? 'bg-brandMoss' : 'bg-brandTerra'} text-white">
                        <i data-lucide="${isBot ? 'bot' : 'user'}" size="14"></i>
                    </div>
                    <div class="p-5 rounded-2xl text-sm leading-relaxed shadow-md ${isBot ? 'chat-bubble-bot' : 'chat-bubble-user'}">
                        <p class="whitespace-pre-wrap">${formattedText}</p>`;

            if (showContact && isBot) {
                contentHtml += `
                    <div class="mt-4 bg-[#FEFAE0] border border-brandMustard/30 rounded-xl p-4 text-center space-y-3">
                        <p class="text-xs text-brandMoss font-bold tracking-tight">Para um acompanhamento personalizado:</p>
                        <a href="https://wa.me/5511960808313" target="_blank" class="flex items-center justify-center gap-2 bg-brandMoss text-white py-2 px-4 rounded-lg text-xs font-bold hover:bg-[#4d572d] transition-colors w-full shadow-sm">
                            <i data-lucide="message-circle" size="14"></i> Falar pelo WhatsApp
                        </a>
                        <p class="text-[9px] text-gray-500 italic uppercase">Agende uma consulta ou orientação parental.</p>
                    </div>`;
            }

            contentHtml += `
                        <p class="text-[10px] text-gray-400 mt-2 text-right italic border-t border-gray-100 pt-2">${isBot ? 'Fga. Amanda Assistant' : 'Você'}</p>
                    </div>
                </div>`;
            
            msgDiv.innerHTML = contentHtml;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            lucide.createIcons();
        }

        async function fetchGeminiResponse(userQuery) {
            const systemPrompt = `Tu és um assistente virtual de apoio em Fonoaudiologia Infantil em nome da Fga. Amanda Elizabeth Gomes (CRFa 2-19715).
            
            DIRETRIZES DE PERSONA:
            - Orientar pais e cuidadores de forma simples, acolhedora e responsável.
            - Vocabulário acessível, sem termos técnicos. Empático e sem julgamentos.
            - Este chat é uma SESSÃO CONTÍNUA. Nunca reinicies com "Olá" após o início.
            - GUARDA CONTEXTO: Lembra idades, queixas e informações já ditas.
            
            LIMITES RÍGIDOS:
            - NÃO realizas diagnósticos. NÃO substituis avaliação presencial.
            - NÃO prescreves terapias ou condutas clínicas específicas.

            DÚVIDAS COMPLEXAS/CLÍNICAS (TEA, Atrasos, Regressão, Diagnósticos):
            Responde GENTILMENTE: "Essa é uma dúvida muito importante, mas para responder com responsabilidade é necessário conhecer a criança e a rotina dela. Para isso, o ideal é falar diretamente com a fonoaudióloga. Você pode entrar em contato pelo WhatsApp do site, agendar uma consulta de avaliação ou uma orientação parental, que ajuda bastante nesses casos."
            
            Encerrar gradualmente deixando espaço para continuidade.`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            // Lógica de Histórico: Gemini exige que comece por 'user'
            chatHistory.push({ role: "user", parts: [{ text: userQuery }] });

            const payload = {
                contents: chatHistory,
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            for (let i = 0; i < 3; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API Error');
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        chatHistory.push({ role: "model", parts: [{ text: text }] });
                        const needsContact = text.includes("fonoaudióloga") || text.includes("WhatsApp") || text.includes("agendar");
                        return { text, needsContact };
                    }
                } catch (e) {
                    await new Promise(r => setTimeout(r, 1000));
                }
            }
            return { text: "No momento não consigo conectar. Por favor, use o WhatsApp do site para falar diretamente conosco.", needsContact: true };
        }

        async function handleSendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            chatInput.value = '';
            
            typingIndicator.classList.remove('hidden');
            const result = await fetchGeminiResponse(text);
            typingIndicator.classList.add('hidden');
            
            addMessage(result.text, 'bot', result.needsContact);
        }

        function handleChatEnter(e) { if (e.key === 'Enter') handleSendMessage(); }
    </script>
</body>
</html>
